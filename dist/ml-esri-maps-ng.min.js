!function(){"use strict";angular.module("ml.esri-maps",[])}(),function(){"use strict";function e(){return{restrict:"E",scope:{geometry:"=",geometries:"=",baseMap:"=",zoom:"=",mapId:"="},templateUrl:"/templates/detail-map.html",controller:"mlEsriDetailMapController",controllerAs:"ctrl"}}function t(e,t){function o(e){var t=[];if(e&&angular.isArray(e))if(angular.isArray(e[0]))for(l=0;l<e.length;l++)isNaN(e[l][0])||2!==e[l].length||t.push({type:"point",latitude:e[l][0],longitude:e[l][1]});else isNaN(e[0])||2!==e.length||t.push({type:"point",latitude:e[0],longitude:e[1]});return t}function i(e){var t=[],o=null;if(e)if(angular.isArray(e))for(var i=0;i<e.length;i++)o=n(e[i]),o&&(angular.isArray(o)?t=t.concat(o):t.push(o));else o=n(e),o&&(angular.isArray(o)?t=t.concat(o):t.push(o));return t}function n(e){var t=null;if(e&&e.type)if("Point"===e.type)t={type:"point",latitude:e.coordinates[1],longitude:e.coordinates[0]};else if("MultiPoint"===e.type)t={type:"multipoint",points:e.coordinates};else if("LineString"===e.type)t={type:"polyline",paths:[e.coordinates]};else if("MultiLineString"===e.type)t={type:"polyline",paths:e.coordinates};else if("Polygon"===e.type)t={type:"polygon",rings:e.coordinates};else if("MultiPolygon"===e.type){t=[];for(var o=0;o<e.coordinates.length;o++)t.push({type:"polygon",rings:e.coordinates[o]})}else console.log("Unknown GeoJSON geometry type: ",e.type);return t}function r(e){require(["esri/map","esri/graphic","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/layers/GraphicsLayer","esri/geometry/Point","esri/geometry/Polygon","esri/geometry/Multipoint","esri/geometry/Polyline","esri/graphicsUtils","esri/Color"],function(t,o,i,n,r,s,l,p,m,y,c,d){function g(e){if(e&&e.length>0){a.mapGeometry=[];for(var t=0;t<e.length;t++)"point"===e[t].type?a.mapGeometry.push(new l(e[t])):"multipoint"===e[t].type?a.mapGeometry.push(new m(e[t])):"polygon"===e[t].type?a.mapGeometry.push(new p(e[t])):"polyline"===e[t].type&&a.mapGeometry.push(new y(e[t]))}}g(e),a.map=new t(a.mapId,{basemap:a.baseMap,zoom:a.mapZoom,smartNavigation:!1}),a.graphicsLayer=new s({id:"data"}),a.map.addLayer(a.graphicsLayer),a.map.on("load",function(){a.mapGeometry&&a.drawData(a.mapGeometry)}),a.drawData=function(e){if(e&&e.length>0){for(var t=0;t<e.length;t++){var s=null;if("point"===e[t].type?s=(new n).setColor(new d([0,0,0,.6])):"multipoint"===e[t].type?s=(new n).setColor(new d([0,0,0,.6])):"polygon"===e[t].type?s=(new i).setColor(new d([0,0,0,.6])):"polyline"===e[t].type&&(s=(new r).setColor(new d([0,0,0,.6]))),s){var l=new o(e[t],s);a.graphicsLayer.add(l)}}var p=c.graphicsExtent(a.graphicsLayer.graphics);a.map.setExtent(p,!0)}}})}var a=this,s=[],l=0;a.mapId=e.mapId?e.mapId:"detail-map-1",a.baseMap=e.baseMap?e.baseMap:"national-geographic",a.mapZoom=e.zoom?e.zoom:6,a.mapGeometry=null,e.geometry&&(s=o(e.geometry)),e.geometries&&(s=i(e.geometries)),e.$watch("mapId",function(e){t(function(){r(s)},300)})}angular.module("ml.esri-maps").directive("mlEsriDetailMap",e).controller("mlEsriDetailMapController",t),t.$inject=["$scope","$timeout"]}(),function(){"use strict";function e(){return{restrict:"E",scope:{options:"=",facets:"=",parentBoundsChanged:"&boundsChanged"},template:'<div id="searchMap" class="map-search"></div>',controller:"mlEsriSearchMapController",controllerAs:"ctrl",link:function(e,t,o){}}}function t(e,t,o){function i(){require(["esri/map","esri/InfoTemplate","esri/graphic","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/TextSymbol","esri/symbols/Font","esri/geometry/webMercatorUtils","esri/Color","esri/geometry/Point","esri/geometry/Polygon","esri/layers/GraphicsLayer"],function(t,i,n,r,s,l,p,m,y,c,d,g){a.map=new t("searchMap",{basemap:a.baseMap,center:a.mapCenter,zoom:a.mapZoom,smartNavigation:!1}),a.graphicsLayer=new g({id:"data"}),a.map.addLayer(a.graphicsLayer),a.markerColors=[new y([255,0,0,.75]),new y([255,85,0,.75]),new y([0,92,230,.75]),new y([169,0,230,.75]),new y([76,230,0,.75])],a.oGrpSym=(new r).setColor(a.markerColors[0]).setOutline((new s).setStyle(s.STYLE_DASH)).setSize(45),a.iGrpSym=(new r).setColor(new y([214,214,214,.5])).setOutline((new s).setStyle(s.STYLE_DASH)).setSize(25),a.textGrpSym=(new l).setColor(new y([0,0,0,1])).setVerticalAlignment("middle").setFont((new p).setWeight(p.WEIGHT_BOLD)),a.map.on("extent-change",function(e){a.notifyExtentChange(e)}),a.graphicsLayer.on("click",function(e){a.markerClicked(e)}),a.notifyExtentChange=function(t){var o=m.xyToLngLat(t.extent.xmin,t.extent.ymax),i=m.xyToLngLat(t.extent.xmax,t.extent.ymin),n={};n.west=o[0],n.north=o[1],n.east=i[0],n.south=i[1],e.bounds=n,e.$apply(function(){e.parentBoundsChanged&&e.parentBoundsChanged({bounds:e.bounds})})},a.markerClicked=function(e){if(e.graphic.attributes&&e.graphic.attributes.detailsId){var t=e.graphic.attributes.detailsId;o.getDocument(e.graphic.attributes.detailsId).then(function(o){if(o.data){var n=o.data.name?o.data.name:t,r='<b><a href="'+a.infoWindow.linkPrefix+t+'" target="_blank">Full Details</a></b>';o.data.name&&(r+="<br/><b>Name</b>: ${name}<br/><b>Email</b>: ${email}<br/><b>Company</b>: ${company}<br/><b>Eye Color</b>: ${eyeColor}<br/><b>Favorite Fruit</b>: ${favoriteFruit}");var s=(new i).setTitle(n).setContent(r);e.graphic.setAttributes(o.data),e.graphic.setInfoTemplate(s)}},function(e){console.log(e)})}},a.addMarker=function(e,t,o){var i,s={};if(1===e.count&&e.uri)i={symbol:(new r).setColor(a.markerColors[o%a.markerColors.length]),geometry:new c({latitude:e.n,longitude:e.e})},s=new n(i.geometry,i.symbol),s.setAttributes({detailsId:e[a.infoWindow.idFieldName]}),a.graphicsLayer.add(s);else{var l=new d([[e.w,e.n],[e.e,e.n],[e.e,e.s],[e.w,e.s],[e.w,e.n]]),p=e.count.toString().length,m=35+10*p,y=25+(p>2?3*(p-2):0);i={symbol:a.oGrpSym.setColor(a.markerColors[o%a.markerColors.length]),geometry:l.getCentroid()},i.symbol.setSize(m),s=new n(i.geometry,i.symbol),a.graphicsLayer.add(s),i={symbol:a.iGrpSym,geometry:l.getCentroid()},i.symbol.setSize(y),s=new n(i.geometry,i.symbol),a.graphicsLayer.add(s);var g={symbol:a.textGrpSym.setText(e.count),geometry:l.getCentroid()},u=new n(g.geometry,g.symbol);a.graphicsLayer.add(u)}}})}function n(){a.graphicsLayer&&a.graphicsLayer.clear()}function r(){var t,o,i,n=0,r=0;if(a.addMarker)for(t in e.facets)if(o=e.facets[t],o&&o.boxes){for(r=0;r<o.boxes.length;r++)i=o.boxes[r],a.addMarker(i,r,n);++n}}var a=this;a.mapCenter=[-97.846,38.591],a.mapZoom=3,a.baseMap="national-geographic",a.infoWindow={titleFieldName:"uri",idFieldName:"uri",linkPrefix:"/detail"},e.options&&(e.options.center&&(a.mapCenter=e.options.center),e.options.zoom&&(a.mapZoom=e.options.zoom),e.options.baseMap&&(a.baseMap=e.options.baseMap),e.options.infoWindow&&(e.options.infoWindow.titleFieldName&&(a.infoWindow.titleFieldName=e.options.infoWindow.titleFieldName),e.options.infoWindow.idFieldName&&(a.infoWindow.idFieldName=e.options.infoWindow.idFieldName),e.options.infoWindow.linkPrefix&&(a.infoWindow.linkPrefix=e.options.infoWindow.linkPrefix))),i(),e.$watch("facets",function(e,t){n(),r()})}angular.module("ml.esri-maps").directive("mlEsriSearchMap",e).controller("mlEsriSearchMapController",t),t.$inject=["$scope","$timeout","MLRest"]}();