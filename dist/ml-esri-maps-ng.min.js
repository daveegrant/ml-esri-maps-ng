!function(){"use strict";angular.module("ml.esri-maps",[])}(),function(){"use strict";function e(){return{restrict:"E",scope:{geometry:"=",baseMap:"=",zoom:"="},template:'<div id="detailMap" class="map-detail"></div>',controller:"mlEsriDetailMapController",controllerAs:"ctrl"}}function t(e){function t(e){require(["esri/map","esri/graphic","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleMarkerSymbol","esri/layers/GraphicsLayer","esri/geometry/Point","esri/geometry/Polygon","esri/graphicsUtils","esri/Color"],function(t,r,a,i,n,s,l,m,p){function c(e){if(e&&e.length>0){o.mapGeometry=[];for(var t=0;t<e.length;t++)"point"===e[t].type?o.mapGeometry.push(new s(e[t])):"polygon"===e[t].type&&o.mapGeometry.push(new l(e[t]))}}c(e),o.map=new t("detailMap",{basemap:o.baseMap,zoom:o.mapZoom,smartNavigation:!1}),o.graphicsLayer=new n({id:"data"}),o.map.addLayer(o.graphicsLayer),o.map.on("load",function(){o.mapGeometry&&o.drawData(o.mapGeometry)}),o.drawData=function(e){if(e&&e.length>0){for(var t=0;t<e.length;t++){var n=null;if(e[t]instanceof s?n=(new i).setColor(new p([0,0,0,.6])):e[t]instanceof l&&(n=(new a).setColor(new p([0,0,0,.6]))),n){var c=new r(e[t],n);o.graphicsLayer.add(c)}}var d=m.graphicsExtent(o.graphicsLayer.graphics);o.map.setExtent(d,!0)}}})}var o=this,r=[],a=0;if(o.baseMap=e.baseMap?e.baseMap:"national-geographic",o.mapZoom=e.zoom?e.zoom:6,o.mapGeometry=null,e.geometry&&angular.isArray(e.geometry))if(angular.isArray(e.geometry[0]))for(a=0;a<e.geometry.length;a++)isNaN(e.geometry[a][0])||2!==e.geometry[a].length||r.push({type:"point",latitude:e.geometry[a][0],longitude:e.geometry[a][1]});else isNaN(e.geometry[0])||2!==e.geometry.length||r.push({type:"point",latitude:e.geometry[0],longitude:e.geometry[1]});t(r)}angular.module("ml.esri-maps").directive("mlEsriDetailMap",e).controller("mlEsriDetailMapController",t),t.$inject=["$scope"]}(),function(){"use strict";function e(){return{restrict:"E",scope:{options:"=",facets:"=",parentBoundsChanged:"&boundsChanged"},template:'<div id="searchMap" class="map-search"></div>',controller:"mlEsriSearchMapController",controllerAs:"ctrl",link:function(e,t,o){}}}function t(e,t,o){function r(){require(["esri/map","esri/InfoTemplate","esri/graphic","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/TextSymbol","esri/symbols/Font","esri/geometry/webMercatorUtils","esri/Color","esri/geometry/Point","esri/geometry/Polygon","esri/layers/GraphicsLayer"],function(t,r,a,i,s,l,m,p,c,d,y,g){n.map=new t("searchMap",{basemap:n.baseMap,center:n.mapCenter,zoom:n.mapZoom,smartNavigation:!1}),n.graphicsLayer=new g({id:"data"}),n.map.addLayer(n.graphicsLayer),n.markerColors=[new c([255,0,0,.75]),new c([255,85,0,.75]),new c([0,92,230,.75]),new c([169,0,230,.75]),new c([76,230,0,.75])],n.oGrpSym=(new i).setColor(n.markerColors[0]).setOutline((new s).setStyle(s.STYLE_DASH)).setSize(45),n.iGrpSym=(new i).setColor(new c([214,214,214,.5])).setOutline((new s).setStyle(s.STYLE_DASH)).setSize(25),n.textGrpSym=(new l).setColor(new c([0,0,0,1])).setVerticalAlignment("middle").setFont((new m).setWeight(m.WEIGHT_BOLD)),n.map.on("extent-change",function(e){n.notifyExtentChange(e)}),n.graphicsLayer.on("click",function(e){n.markerClicked(e)}),n.notifyExtentChange=function(t){var o=p.xyToLngLat(t.extent.xmin,t.extent.ymax),r=p.xyToLngLat(t.extent.xmax,t.extent.ymin),a={};a.west=o[0],a.north=o[1],a.east=r[0],a.south=r[1],e.bounds=a,e.$apply(function(){e.parentBoundsChanged&&e.parentBoundsChanged({bounds:e.bounds})})},n.markerClicked=function(e){if(e.graphic.attributes&&e.graphic.attributes.detailsId){var t=e.graphic.attributes.detailsId;o.getDocument(e.graphic.attributes.detailsId).then(function(o){if(o.data){var a=o.data.name?o.data.name:t,i='<b><a href="'+n.infoWindow.linkPrefix+t+'" target="_blank">Full Details</a></b>';o.data.name&&(i+="<br/><b>Name</b>: ${name}<br/><b>Email</b>: ${email}<br/><b>Company</b>: ${company}<br/><b>Eye Color</b>: ${eyeColor}<br/><b>Favorite Fruit</b>: ${favoriteFruit}");var s=(new r).setTitle(a).setContent(i);e.graphic.setAttributes(o.data),e.graphic.setInfoTemplate(s)}},function(e){console.log(e)})}},n.addMarker=function(e,t,o){var r,s={};if(1===e.count&&e.uri)r={symbol:(new i).setColor(n.markerColors[o%n.markerColors.length]),geometry:new d({latitude:e.n,longitude:e.e})},s=new a(r.geometry,r.symbol),s.setAttributes({detailsId:e[n.infoWindow.idFieldName]}),n.graphicsLayer.add(s);else{var l=new y([[e.w,e.n],[e.e,e.n],[e.e,e.s],[e.w,e.s],[e.w,e.n]]),m=e.count.toString().length,p=35+10*m,c=25+(m>2?3*(m-2):0);r={symbol:n.oGrpSym.setColor(n.markerColors[o%n.markerColors.length]),geometry:l.getCentroid()},r.symbol.setSize(p),s=new a(r.geometry,r.symbol),n.graphicsLayer.add(s),r={symbol:n.iGrpSym,geometry:l.getCentroid()},r.symbol.setSize(c),s=new a(r.geometry,r.symbol),n.graphicsLayer.add(s);var g={symbol:n.textGrpSym.setText(e.count),geometry:l.getCentroid()},u=new a(g.geometry,g.symbol);n.graphicsLayer.add(u)}}})}function a(){n.graphicsLayer&&n.graphicsLayer.clear()}function i(){var t,o,r,a=0,i=0;if(n.addMarker)for(t in e.facets)if(o=e.facets[t],o&&o.boxes){for(i=0;i<o.boxes.length;i++)r=o.boxes[i],n.addMarker(r,i,a);++a}}var n=this;n.mapCenter=[-97.846,38.591],n.mapZoom=3,n.baseMap="national-geographic",n.infoWindow={titleFieldName:"uri",idFieldName:"uri",linkPrefix:"/detail"},e.options&&(e.options.center&&(n.mapCenter=e.options.center),e.options.zoom&&(n.mapZoom=e.options.zoom),e.options.baseMap&&(n.baseMap=e.options.baseMap),e.options.infoWindow&&(e.options.infoWindow.titleFieldName&&(n.infoWindow.titleFieldName=e.options.infoWindow.titleFieldName),e.options.infoWindow.idFieldName&&(n.infoWindow.idFieldName=e.options.infoWindow.idFieldName),e.options.infoWindow.linkPrefix&&(n.infoWindow.linkPrefix=e.options.infoWindow.linkPrefix))),r(),e.$watch("facets",function(e,t){a(),i()})}angular.module("ml.esri-maps").directive("mlEsriSearchMap",e).controller("mlEsriSearchMapController",t),t.$inject=["$scope","$timeout","MLRest"]}();